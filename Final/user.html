<!-- user.html -->
<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8" />
  <title>TAçš„ä¸»é¡µ</title>
  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <nav>
    <span id="logo">ğŸ“š å¤å­£ç½¢äº†</span>
    <div id="navContent">
      <a href="index.html">é¦–é¡µ</a>
      <a href="profile.html">ä¸ªäººä¸»é¡µ</a>
      <a href="#" onclick="logout()">é€€å‡º</a>
    </div>
  </nav>

  <main class="Card">
    <h2 id="taName">ç”¨æˆ·ä¸»é¡µ</h2>
    <p id="taInfo"></p>
    <p>
      <span id="followInfo"></span>
      <button id="followBtn"></button>
      <button>ç§ä¿¡</button>
    </p>
    <h3>TAçš„åŠ¨æ€</h3>
    <div id="taPosts"></div>
  </main>

  <script src="js/storage.js"></script>
  <script>
    const params = new URLSearchParams(location.search);
    const taId = params.get("id");
    const taUser = getUsers()[taId];

    if (!taUser || taId === currentUser.id) {
      location.href = "profile.html";
    }

    const followers = taUser.followers || [];
    const following = taUser.following || [];

    document.getElementById("taName").innerText = `${taUser.name} çš„ä¸»é¡µ`;
    document.getElementById("taInfo").innerHTML = `
      <p><img src="${taUser.avatar || ''}" style="width:100px;height:100px;border-radius:50%;overflow:hidden;" /></p>
      <p><strong>ç®€ä»‹ï¼š</strong>${taUser.intro}</p>
      <p><strong>æ ‡ç­¾ï¼š</strong>${taUser.tags?.join(' ') || ''}</p>
    `;

    document.getElementById("followInfo").innerText = `ç²‰ä¸ ${followers.length || 0} | å·²å…³æ³¨ ${following.length || 0}`;

    const isFollowing = (taUser.followers || []).includes(currentUser.id);
    document.getElementById("followBtn").innerText = isFollowing ? "å–æ¶ˆå…³æ³¨" : "å…³æ³¨TA";
    document.getElementById("followBtn").onclick = function () {
      const users = getUsers();
      const me = users[currentUser.id];
      const him = users[taId];

      him.followers = him.followers || [];
      me.following = me.following || [];

      if (isFollowing) {
        him.followers = him.followers.filter(id => id !== currentUser.id);
        me.following = me.following.filter(id => id !== taId);
      } else {
        him.followers.push(currentUser.id);
        me.following.push(taId);
      }

      saveUsers(users);
      location.reload();
    };

    const taPosts = getAllPosts().filter(p => p.author.id === taId && p.visibility === "public");
    const taPostsDiv = document.getElementById("taPosts");
    taPosts.forEach(post => {
      taPostsDiv.innerHTML += `<p>${new Date(post.timestamp).toLocaleString()} - ${post.content}</p>`;
    });

    function logout() {
      localStorage.removeItem("currentUser");
      location.href = "index.html";
    }

  </script>

  <footer>
    <p>Webç¼–ç¨‹å¤§ä½œä¸šâ€”â€”<strong>ä½ è¯´å¾—é˜Ÿ</strong><br />é™ˆ&nbsp &nbspç¿ - 2023150070 &nbsp æå† éœ† - 2023150135<br />ä½•éš½çƒ¨ - 2023150134
      &nbsp é™ˆæ€å®‡ - 2023150048
    </p>
  </footer>
</body>

</html>