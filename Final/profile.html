<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8" />
  <title>ä¸ªäººä¸»é¡µ</title>
  <link rel="stylesheet" href="style.css" />
</head>

<body>

  <nav>
    <span id="logo">ğŸ“š å¤å­£ç½¢äº†</span>
    <div id="navContent">
      <a href="index.html">é¦–é¡µ</a>
      <a href="post.html">å‘åŠ¨æ€</a>
      <a id="navUserArea" href="auth.html">æ³¨å†Œ / ç™»å½•</a>
      <button class="theme-toggle" onclick="toggleTheme()">ğŸŒ™</button>
      <a href="#" onclick="logout()">é€€å‡º</a>
    </div>
  </nav>


  <main class="Card">
    <h2>ä¸ªäººèµ„æ–™</h2>
    <div id="userInfo"></div>
    <h3>å†å²åŠ¨æ€</h3>
    <div id="userPosts"></div>
  </main>

  <script src="js/storage.js"></script>
  <script>
    if (!currentUser) {
      alert("æœªç™»å½•");
      location.href = "auth.html";
    }

    const infoDiv = document.getElementById("userInfo");
    infoDiv.innerHTML = `

    <div style="display:flex;align-items:center;gap:20px;margin-bottom:20px;">
      <div style="width:100px;height:100px;border-radius:50%;overflow:hidden;">
        <img src="${currentUser.avatar || 'default-avatar.jpg'}" style="width:100%;height:100%;object-fit:cover;" id="avatarDisplay" />
      </div>
      <div>
        <p><strong>å­¦å·ï¼š</strong>${currentUser.id}</p>
        <p><strong>æ˜µç§°ï¼š</strong><input id="nameEdit" value="${currentUser.name}" /></p>
      </div>
    </div>
    <span><strong>å¤´åƒï¼š</strong></span>
    <input type="file" id="avatarUpload" accept="image/*" />
    <input id="avatarEdit" type="" value="${currentUser.avatar}" placeholder="æˆ–è¾“å…¥å¤´åƒé“¾æ¥" /><p><strong>ç®€ä»‹ï¼š</strong><input id="introEdit" value="${currentUser.intro}" /></p>
    <p><strong>å…´è¶£ï¼š</strong><input id="tagsEdit" value="${currentUser.tags.join(' ')}" /></p>
    <button onclick="updateProfile()">ä¿å­˜ä¿®æ”¹</button>
    <p style="color:gray;font-size:0.9rem;margin-top:10px;">æœ€è¿‘ç™»å½•ï¼š${new Date(currentUser.lastLogin).toLocaleString()}<br>è®¿é—®é‡ï¼š${currentUser.visitCount}</p>
  `;

    function updateProfile() {
      currentUser.name = nameEdit.value.trim();
      currentUser.avatar = avatarEdit.value.trim();
      currentUser.intro = introEdit.value.trim();
      currentUser.tags = tagsEdit.value.trim().split(/\s+/);
      const users = getUsers();
      users[currentUser.id] = currentUser;
      saveUsers(users);
      alert("èµ„æ–™å·²æ›´æ–°ï¼");
      location.reload();
    }

    const allPosts = getAllPosts();
    const myPosts = allPosts.filter(p => p.author.id === currentUser.id);
    const userPostsDiv = document.getElementById("userPosts");

    // æ£€æŸ¥åŠ¨æ€
    if (myPosts.length === 0) {
      userPostsDiv.innerHTML = `<p style="color:gray">æš‚æ— å†å²åŠ¨æ€</p>`;
    } else {
      myPosts.forEach(post => {
        userPostsDiv.innerHTML += `<p>${new Date(post.timestamp).toLocaleString()} - ${post.content}</p>`;
      });
    }

    // ç™»å‡º
    function logout() {
      localStorage.removeItem("currentUser");
      location.href = "index.html";
    }
  </script>

  <footer>
    <p>Webç¼–ç¨‹å¤§ä½œä¸šâ€”â€”<strong>ä½ è¯´å¾—é˜Ÿ</strong><br />é™ˆ&nbsp &nbspç¿ - 2023150070 &nbsp æå† éœ† - 2023150135<br />ä½•éš½çƒ¨ - 2023150134
      &nbsp é™ˆæ€å®‡ - 2023150048
    </p>
  </footer>
</body>

</html>