<!DOCTYPE html>
<html lang="zh">

<head>
  <meta charset="UTF-8" />
  <title>æ³¨å†Œ / ç™»å½•</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    .auth-box {
      max-width: 500px;
      margin: 50px auto;
      background: white;
      padding: 2rem;
      border-radius: 10px;
      box-shadow: var(--shadow);
    }

    .auth-box input[type="text"],
    .auth-box input[type="password"],
    select {
      margin-top: 8px;
      width: 100%;
      padding: 8px;
    }

    .auth-box label {
      display: block;
      margin-top: 15px;
      font-weight: bold;
    }

    .auth-actions {
      margin-top: 20px;
      text-align: center;
    }

    .auth-toggle {
      color: var(--primary);
      cursor: pointer;
    }

    .small-text {
      font-size: 0.85rem;
      color: gray;
      text-align: right;
    }
  </style>
</head>

<body>

  <nav>
    <span id="logo">ğŸ“š å¤å­£ç½¢äº†</span>
    <div id="navContent">
      <a href="index.html">é¦–é¡µ</a>
      <button class="theme-toggle" onclick="toggleTheme()">ğŸŒ™</button>
      <a href="#" onclick="logout()">é€€å‡º</a>
    </div>
  </nav>

  <div class="auth-box" id="authBox">
    <h2 id="authTitle">ç™»å½•</h2>

    <div id="loginForm">
      <label>å­¦å·</label><input id="loginId" type="text" placeholder="è¯·è¾“å…¥å­¦å·" />
      <label>å¯†ç </label><input id="loginPwd" type="password" placeholder="è¯·è¾“å…¥å¯†ç " />
      <input type="checkbox" id="showPwd" /> æ˜¾ç¤ºå¯†ç 
      <input type="checkbox" id="rememberMe" /> è®°ä½æˆ‘
      <div class="small-text"><a href="#" onclick="alert('è¯·è”ç³»ç®¡ç†å‘˜é‡ç½®å¯†ç ')">å¿˜è®°å¯†ç ï¼Ÿ</a></div>

      <div class="auth-actions">
        <button onclick="login()">ç™»å½•</button>
      </div>
      <div class="auth-toggle" onclick="toggleForm()">æ²¡æœ‰è´¦å·ï¼Ÿæ³¨å†Œ</div>
    </div>

    <div id="registerForm" style="display: none;">
      <label>å­¦å·</label><input id="regId" type="text" />
      <label>å¯†ç </label><input id="regPwd" type="password" />
      <label>ç¡®è®¤å¯†ç </label><input id="regPwd2" type="password" />
      <label>æ˜µç§°</label><input id="regName" type="text" />
      <label>å¤´åƒ</label><input id="regAvatarUpload" type="file" accept="image/*" />
      <small>æˆ–è¾“å…¥å¤´åƒé“¾æ¥</small><input id="regAvatar" type="url" placeholder="å¯é€‰ï¼Œç²˜è´´å›¾ç‰‡é“¾æ¥" />
      <div id="avatarPreview" style="width:100px;height:100px;margin-top:10px;border-radius:50%;overflow:hidden;"></div>
      <label>å…´è¶£æ ‡ç­¾ï¼ˆç”¨ç©ºæ ¼åˆ†éš”ï¼‰</label><input id="regTags" type="text" />
      <label>ä¸ªäººç®€ä»‹</label><input id="regIntro" type="text" />
      <div class="auth-actions">
        <button onclick="register()">æ³¨å†Œ</button>
      </div>
      <div class="auth-toggle" onclick="toggleForm()">å·²æœ‰è´¦å·ï¼Ÿç™»å½•</div>
    </div>
  </div>

  <script src="js/storage.js"></script>
  <script>
    const loginForm = document.getElementById("loginForm");
    const registerForm = document.getElementById("registerForm");
    const authTitle = document.getElementById("authTitle");

    function toggleForm() {
      const showLogin = loginForm.style.display === "none";
      loginForm.style.display = showLogin ? "block" : "none";
      registerForm.style.display = showLogin ? "none" : "block";
      authTitle.innerText = showLogin ? "ç™»å½•" : "æ³¨å†Œ";
    }

    document.getElementById("showPwd").addEventListener("change", function () {
      const pwd = document.getElementById("loginPwd");
      pwd.type = this.checked ? "text" : "password";
    });

    function register() {
      const id = regId.value.trim();
      const pwd = regPwd.value;
      const pwd2 = regPwd2.value;
      if (!/^\d{6,20}$/.test(id)) return alert("å­¦å·åº”ä¸º6ä½ä»¥ä¸Šæ•°å­—");
      if (pwd.length < 4) return alert("å¯†ç å¤ªçŸ­");
      if (pwd !== pwd2) return alert("ä¸¤æ¬¡å¯†ç ä¸ä¸€è‡´");

      const users = getUsers();
      if (users[id]) return alert("è¯¥å­¦å·å·²æ³¨å†Œ");

      users[id] = {
        id,
        password: pwd,
        name: regName.value.trim() || `ç”¨æˆ·${id}`,
        avatar: regAvatar.value.trim() || 'pics/default-avatar.png',  // æ·»åŠ é»˜è®¤å¤´åƒ
        tags: regTags.value.trim().split(/\s+/),
        intro: regIntro.value.trim(),
        banned: false,
        lastLogin: new Date().toISOString(),
        visitCount: 0,
      };
      saveUsers(users);
      alert("æ³¨å†ŒæˆåŠŸï¼");
      toggleForm();
    }

    function login() {
      const id = loginId.value.trim();
      const pwd = loginPwd.value;
      const users = getUsers();
      if (!users[id]) return alert("ç”¨æˆ·ä¸å­˜åœ¨");
      if (users[id].banned) return alert("è´¦å·å·²è¢«å°ç¦");
      if (users[id].password !== pwd) return alert("å¯†ç é”™è¯¯");

      users[id].lastLogin = new Date().toISOString();
      users[id].visitCount = (users[id].visitCount || 0) + 1;
      saveUsers(users);

      if (rememberMe.checked) localStorage.setItem("rememberUser", id);
      localStorage.setItem("currentUser", id);
      alert("ç™»å½•æˆåŠŸï¼");
      location.href = "index.html";
    }// æ·»åŠ å¤´åƒé¢„è§ˆåŠŸèƒ½
    document.getElementById("regAvatarUpload").addEventListener("change", function (e) {
      const file = e.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function (e) {
        document.getElementById("avatarPreview").innerHTML =
          `<img src="${e.target.result}" style="width:100%;height:100%;object-fit:cover;">`;
        document.getElementById("regAvatar").value = e.target.result;
      };
      reader.readAsDataURL(file);
    });
  </script>

  <footer>
    <p>Webç¼–ç¨‹å¤§ä½œä¸šâ€”â€”<strong>ä½ è¯´å¾—é˜Ÿ</strong><br />é™ˆ&nbsp &nbspç¿ - 2023150070 &nbsp æå† éœ† - 2023150135<br />ä½•éš½çƒ¨ - 2023150134
      &nbsp é™ˆæ€å®‡ - 2023150048
    </p>
  </footer>
</body>

</html>